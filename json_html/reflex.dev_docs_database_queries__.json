{
  "url": "https://reflex.dev/docs/database/queries/\n",
  "sections": [
    "<h1 class=\"rt-Heading rt-r-size-6 font-x-large lg:font-xx-large scroll-m-[5rem] mt-4\" id=\"queries\">Queries</h1><svg class=\"lucide lucide-link !text-violet-11 invisible transition-[visibility_0.075s_ease-out] group-hover:visible mt-4 css-svt5ra\" fill=\"none\" height=\"18\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg></a><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">Queries are used to retrieve data from a database.</p><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">A query is a request for information from a database table or combination of\ntables. A query can be used to retrieve data from a single table or multiple\ntables. A query can also be used to insert, update, or delete data from a table.</p><a class=\"rt-Text rt-reset rt-Link rt-underline-none flex flex-row items-center gap-6 hover:!text-violet-11 text-slate-12 cursor-pointer mb-2 transition-colors group css-1macts\" data-accent-color=\"\" href=\"https://reflex.dev/docs/database/queries/#session\">",
    "<h2 class=\"rt-Heading rt-r-size-6 font-large lg:font-x-large scroll-m-[5rem] mt-8\" id=\"session\">Session</h2><svg class=\"lucide lucide-link !text-violet-11 invisible transition-[visibility_0.075s_ease-out] group-hover:visible mt-8 css-svt5ra\" fill=\"none\" height=\"18\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg></a><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">To execute a query you must first create a <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">rx.session</code>. You can use the session\nto query the database using SQLModel or SQLAlchemy syntax.</p><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">The <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">rx.session</code> statement will automatically close the session when the code\nblock is finished. <strong>If <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">session.commit()</code> is not called, the changes will be\nrolled back and not persisted to the database.</strong> The code can also explicitly\nrollback without closing the session via <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">session.rollback()</code>.</p><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">The following example shows how to create a session and query the database.\nFirst we create a table called <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">User</code>.</p><pre><div class=\"rt-Box relative mb-4\"><div class=\"rt-Box code-block css-1islnds\"><div><pre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#C678DD\">class</span><span style=\"color:#E5C07B\"> User</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#E5C07B\">Model</span><span style=\"color:#ABB2BF\">, </span><span style=\"color:#E06C75;font-style:italic\">table</span><span style=\"color:#56B6C2\">=</span><span style=\"color:#D19A66\">True</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">    username: </span><span style=\"color:#56B6C2\">str</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">    email: </span><span style=\"color:#56B6C2\">str</span></span>\n<span class=\"line\"></span></code></pre></div><button class=\"css-kobh7h\"><svg class=\"lucide lucide-copy css-cqk0y8\" fill=\"none\" height=\"16\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div></pre><a class=\"rt-Text rt-reset rt-Link rt-underline-none flex flex-row items-center gap-6 hover:!text-violet-11 text-slate-12 cursor-pointer mb-2 transition-colors group css-1macts\" data-accent-color=\"\" href=\"https://reflex.dev/docs/database/queries/#select\">",
    "<h3 class=\"rt-Heading rt-r-size-6 font-large scroll-m-[5rem] mt-4\" id=\"select\">Select</h3><svg class=\"lucide lucide-link !text-violet-11 invisible transition-[visibility_0.075s_ease-out] group-hover:visible mt-4 css-svt5ra\" fill=\"none\" height=\"18\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg></a><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">Then we create a session and query the User table.</p><pre><div class=\"rt-Box relative mb-4\"><div class=\"rt-Box code-block css-1islnds\"><div><pre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#C678DD\">class</span><span style=\"color:#E5C07B\"> QueryUser</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#E5C07B\">State</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">    name: </span><span style=\"color:#56B6C2\">str</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">    users: list[User]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#61AFEF\">    @rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#61AFEF\">event</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">    def</span><span style=\"color:#61AFEF\"> get_users</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B;font-style:italic\">self</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">        with</span><span style=\"color:#ABB2BF\"> rx.</span><span style=\"color:#61AFEF\">session</span><span style=\"color:#ABB2BF\">() </span><span style=\"color:#C678DD\">as</span><span style=\"color:#ABB2BF\"> session:</span></span>\n<span class=\"line\"><span style=\"color:#E5C07B\">            self</span><span style=\"color:#ABB2BF\">.users </span><span style=\"color:#56B6C2\">=</span><span style=\"color:#ABB2BF\"> session.</span><span style=\"color:#61AFEF\">exec</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                User.</span><span style=\"color:#61AFEF\">select</span><span style=\"color:#ABB2BF\">().</span><span style=\"color:#61AFEF\">where</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                    User.username.</span><span style=\"color:#61AFEF\">contains</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">self</span><span style=\"color:#ABB2BF\">.name)</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                )</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            ).</span><span style=\"color:#61AFEF\">all</span><span style=\"color:#ABB2BF\">()</span></span>\n<span class=\"line\"></span></code></pre></div><button class=\"css-kobh7h\"><svg class=\"lucide lucide-copy css-cqk0y8\" fill=\"none\" height=\"16\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div></pre><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">The <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">get_users</code> method will query the database for all users that contain the\nvalue of the state var <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">name</code>.</p><a class=\"rt-Text rt-reset rt-Link rt-underline-none flex flex-row items-center gap-6 hover:!text-violet-11 text-slate-12 cursor-pointer mb-2 transition-colors group css-1macts\" data-accent-color=\"\" href=\"https://reflex.dev/docs/database/queries/#insert\">",
    "<h3 class=\"rt-Heading rt-r-size-6 font-large scroll-m-[5rem] mt-4\" id=\"insert\">Insert</h3><svg class=\"lucide lucide-link !text-violet-11 invisible transition-[visibility_0.075s_ease-out] group-hover:visible mt-4 css-svt5ra\" fill=\"none\" height=\"18\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg></a><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">Similarly, the <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">session.add()</code> method to add a new record to the\ndatabase or persist an existing object.</p><pre><div class=\"rt-Box relative mb-4\"><div class=\"rt-Box code-block css-1islnds\"><div><pre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#C678DD\">class</span><span style=\"color:#E5C07B\"> AddUser</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#E5C07B\">State</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">    username: </span><span style=\"color:#56B6C2\">str</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">    email: </span><span style=\"color:#56B6C2\">str</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#61AFEF\">    @rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#61AFEF\">event</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">    def</span><span style=\"color:#61AFEF\"> add_user</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B;font-style:italic\">self</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">        with</span><span style=\"color:#ABB2BF\"> rx.</span><span style=\"color:#61AFEF\">session</span><span style=\"color:#ABB2BF\">() </span><span style=\"color:#C678DD\">as</span><span style=\"color:#ABB2BF\"> session:</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">add</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#61AFEF\">                User</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#E06C75;font-style:italic\">                    username</span><span style=\"color:#56B6C2\">=</span><span style=\"color:#E5C07B\">self</span><span style=\"color:#ABB2BF\">.username, </span><span style=\"color:#E06C75;font-style:italic\">email</span><span style=\"color:#56B6C2\">=</span><span style=\"color:#E5C07B\">self</span><span style=\"color:#ABB2BF\">.email</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                )</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            )</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">commit</span><span style=\"color:#ABB2BF\">()</span></span>\n<span class=\"line\"></span></code></pre></div><button class=\"css-kobh7h\"><svg class=\"lucide lucide-copy css-cqk0y8\" fill=\"none\" height=\"16\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div></pre><a class=\"rt-Text rt-reset rt-Link rt-underline-none flex flex-row items-center gap-6 hover:!text-violet-11 text-slate-12 cursor-pointer mb-2 transition-colors group css-1macts\" data-accent-color=\"\" href=\"https://reflex.dev/docs/database/queries/#update\">",
    "<h3 class=\"rt-Heading rt-r-size-6 font-large scroll-m-[5rem] mt-4\" id=\"update\">Update</h3><svg class=\"lucide lucide-link !text-violet-11 invisible transition-[visibility_0.075s_ease-out] group-hover:visible mt-4 css-svt5ra\" fill=\"none\" height=\"18\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg></a><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">To update the user, first query the database for the object, make the desired\nmodifications, <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">.add</code> the object to the session and finally call <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">.commit()</code>.</p><pre><div class=\"rt-Box relative mb-4\"><div class=\"rt-Box code-block css-1islnds\"><div><pre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#C678DD\">class</span><span style=\"color:#E5C07B\"> ChangeEmail</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#E5C07B\">State</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">    username: </span><span style=\"color:#56B6C2\">str</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">    email: </span><span style=\"color:#56B6C2\">str</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#61AFEF\">    @rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#61AFEF\">event</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">    def</span><span style=\"color:#61AFEF\"> modify_user</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B;font-style:italic\">self</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">        with</span><span style=\"color:#ABB2BF\"> rx.</span><span style=\"color:#61AFEF\">session</span><span style=\"color:#ABB2BF\">() </span><span style=\"color:#C678DD\">as</span><span style=\"color:#ABB2BF\"> session:</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            user </span><span style=\"color:#56B6C2\">=</span><span style=\"color:#ABB2BF\"> session.</span><span style=\"color:#61AFEF\">exec</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                User.</span><span style=\"color:#61AFEF\">select</span><span style=\"color:#ABB2BF\">().</span><span style=\"color:#61AFEF\">where</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                    (User.username </span><span style=\"color:#56B6C2\">==</span><span style=\"color:#E5C07B\"> self</span><span style=\"color:#ABB2BF\">.username)</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                )</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            ).</span><span style=\"color:#61AFEF\">first</span><span style=\"color:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            user.email </span><span style=\"color:#56B6C2\">=</span><span style=\"color:#E5C07B\"> self</span><span style=\"color:#ABB2BF\">.email</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">add</span><span style=\"color:#ABB2BF\">(user)</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">commit</span><span style=\"color:#ABB2BF\">()</span></span>\n<span class=\"line\"></span></code></pre></div><button class=\"css-kobh7h\"><svg class=\"lucide lucide-copy css-cqk0y8\" fill=\"none\" height=\"16\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div></pre><a class=\"rt-Text rt-reset rt-Link rt-underline-none flex flex-row items-center gap-6 hover:!text-violet-11 text-slate-12 cursor-pointer mb-2 transition-colors group css-1macts\" data-accent-color=\"\" href=\"https://reflex.dev/docs/database/queries/#delete\">",
    "<h3 class=\"rt-Heading rt-r-size-6 font-large scroll-m-[5rem] mt-4\" id=\"delete\">Delete</h3><svg class=\"lucide lucide-link !text-violet-11 invisible transition-[visibility_0.075s_ease-out] group-hover:visible mt-4 css-svt5ra\" fill=\"none\" height=\"18\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg></a><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">To delete a user, first query the database for the object, then call\n<code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">.delete()</code> on the session and finally call <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">.commit()</code>.</p><pre><div class=\"rt-Box relative mb-4\"><div class=\"rt-Box code-block css-1islnds\"><div><pre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#C678DD\">class</span><span style=\"color:#E5C07B\"> RemoveUser</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#E5C07B\">State</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">    username: </span><span style=\"color:#56B6C2\">str</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#61AFEF\">    @rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#61AFEF\">event</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">    def</span><span style=\"color:#61AFEF\"> delete_user</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B;font-style:italic\">self</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">        with</span><span style=\"color:#ABB2BF\"> rx.</span><span style=\"color:#61AFEF\">session</span><span style=\"color:#ABB2BF\">() </span><span style=\"color:#C678DD\">as</span><span style=\"color:#ABB2BF\"> session:</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            user </span><span style=\"color:#56B6C2\">=</span><span style=\"color:#ABB2BF\"> session.</span><span style=\"color:#61AFEF\">exec</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                User.</span><span style=\"color:#61AFEF\">select</span><span style=\"color:#ABB2BF\">().</span><span style=\"color:#61AFEF\">where</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                    User.username </span><span style=\"color:#56B6C2\">==</span><span style=\"color:#E5C07B\"> self</span><span style=\"color:#ABB2BF\">.username</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                )</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            ).</span><span style=\"color:#61AFEF\">first</span><span style=\"color:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">delete</span><span style=\"color:#ABB2BF\">(user)</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">commit</span><span style=\"color:#ABB2BF\">()</span></span>\n<span class=\"line\"></span></code></pre></div><button class=\"css-kobh7h\"><svg class=\"lucide lucide-copy css-cqk0y8\" fill=\"none\" height=\"16\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div></pre><a class=\"rt-Text rt-reset rt-Link rt-underline-none flex flex-row items-center gap-6 hover:!text-violet-11 text-slate-12 cursor-pointer mb-2 transition-colors group css-1macts\" data-accent-color=\"\" href=\"https://reflex.dev/docs/database/queries/#orm-object-lifecycle\">",
    "<h2 class=\"rt-Heading rt-r-size-6 font-large lg:font-x-large scroll-m-[5rem] mt-8\" id=\"orm-object-lifecycle\">ORM Object Lifecycle</h2><svg class=\"lucide lucide-link !text-violet-11 invisible transition-[visibility_0.075s_ease-out] group-hover:visible mt-8 css-svt5ra\" fill=\"none\" height=\"18\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg></a><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">The objects returned by queries are bound to the session that created them, and cannot generally\nbe used outside that session. After adding or updating an object, not all fields are automatically\nupdated, so accessing certain attributes may trigger additional queries to refresh the object.</p><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">To avoid this, the <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">session.refresh()</code> method can be used to update the object explicitly and\nensure all fields are up to date before exiting the session.</p><pre><div class=\"rt-Box relative mb-4\"><div class=\"rt-Box code-block css-1islnds\"><div><pre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#C678DD\">class</span><span style=\"color:#E5C07B\"> AddUserForm</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#E5C07B\">State</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">    user: User </span><span style=\"color:#56B6C2\">|</span><span style=\"color:#D19A66\"> None</span><span style=\"color:#56B6C2\"> =</span><span style=\"color:#D19A66\"> None</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#61AFEF\">    @rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#61AFEF\">event</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">    def</span><span style=\"color:#61AFEF\"> add_user</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B;font-style:italic\">self</span><span style=\"color:#ABB2BF\">, </span><span style=\"color:#D19A66;font-style:italic\">form_data</span><span style=\"color:#ABB2BF\">: dict[</span><span style=\"color:#56B6C2\">str</span><span style=\"color:#ABB2BF\">, Any]):</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">        with</span><span style=\"color:#ABB2BF\"> rx.</span><span style=\"color:#61AFEF\">session</span><span style=\"color:#ABB2BF\">() </span><span style=\"color:#C678DD\">as</span><span style=\"color:#ABB2BF\"> session:</span></span>\n<span class=\"line\"><span style=\"color:#E5C07B\">            self</span><span style=\"color:#ABB2BF\">.user </span><span style=\"color:#56B6C2\">=</span><span style=\"color:#61AFEF\"> User</span><span style=\"color:#ABB2BF\">(**form_data)</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">add</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">self</span><span style=\"color:#ABB2BF\">.user)</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">commit</span><span style=\"color:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">refresh</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">self</span><span style=\"color:#ABB2BF\">.user)</span></span>\n<span class=\"line\"></span></code></pre></div><button class=\"css-kobh7h\"><svg class=\"lucide lucide-copy css-cqk0y8\" fill=\"none\" height=\"16\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div></pre><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">Now the <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">self.user</code> object will have a correct reference to the autogenerated\nprimary key, <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">id</code>, even though this was not provided when the object was created\nfrom the form data.</p><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">If <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">self.user</code> needs to be modified or used in another query in a new session,\nit must be added to the session. Adding an object to a session does not\nnecessarily create the object, but rather associates it with a session where it\nmay either be created or updated accordingly.</p><pre><div class=\"rt-Box relative mb-4\"><div class=\"rt-Box code-block css-1islnds\"><div><pre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#C678DD\">class</span><span style=\"color:#E5C07B\"> AddUserForm</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#E5C07B\">State</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#D19A66\">    ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#61AFEF\">    @rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#61AFEF\">event</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">    def</span><span style=\"color:#61AFEF\"> update_user</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B;font-style:italic\">self</span><span style=\"color:#ABB2BF\">, </span><span style=\"color:#D19A66;font-style:italic\">form_data</span><span style=\"color:#ABB2BF\">: dict[</span><span style=\"color:#56B6C2\">str</span><span style=\"color:#ABB2BF\">, Any]):</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">        if</span><span style=\"color:#E5C07B\"> self</span><span style=\"color:#ABB2BF\">.user </span><span style=\"color:#C678DD\">is</span><span style=\"color:#D19A66\"> None</span><span style=\"color:#ABB2BF\">:</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">            return</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">        with</span><span style=\"color:#ABB2BF\"> rx.</span><span style=\"color:#61AFEF\">session</span><span style=\"color:#ABB2BF\">() </span><span style=\"color:#C678DD\">as</span><span style=\"color:#ABB2BF\"> session:</span></span>\n<span class=\"line\"><span style=\"color:#E5C07B\">            self</span><span style=\"color:#ABB2BF\">.user.</span><span style=\"color:#61AFEF\">set</span><span style=\"color:#ABB2BF\">(**form_data)</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">add</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">self</span><span style=\"color:#ABB2BF\">.user)</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">commit</span><span style=\"color:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">refresh</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">self</span><span style=\"color:#ABB2BF\">.user)</span></span>\n<span class=\"line\"></span></code></pre></div><button class=\"css-kobh7h\"><svg class=\"lucide lucide-copy css-cqk0y8\" fill=\"none\" height=\"16\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div></pre><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">If an ORM object will be referenced and accessed outside of a session, you\nshould call <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">.refresh()</code> on it to avoid stale object exceptions.</p><a class=\"rt-Text rt-reset rt-Link rt-underline-none flex flex-row items-center gap-6 hover:!text-violet-11 text-slate-12 cursor-pointer mb-2 transition-colors group css-1macts\" data-accent-color=\"\" href=\"https://reflex.dev/docs/database/queries/#using-sql-directly\">",
    "<h2 class=\"rt-Heading rt-r-size-6 font-large lg:font-x-large scroll-m-[5rem] mt-8\" id=\"using-sql-directly\">Using SQL Directly</h2><svg class=\"lucide lucide-link !text-violet-11 invisible transition-[visibility_0.075s_ease-out] group-hover:visible mt-8 css-svt5ra\" fill=\"none\" height=\"18\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg></a><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">Avoiding SQL is one of the main benefits of using an ORM, but sometimes it is\nnecessary for particularly complex queries, or when using database-specific\nfeatures.</p><p class=\"rt-Text font-normal text-slate-12 mb-4 leading-7\">SQLModel exposes the <code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">session.execute()</code> method that can be used to execute raw\nSQL strings.  If parameter binding is needed, the query may be wrapped in\n<a class=\"rt-Text rt-reset rt-Link rt-underline-always css-1io25ou\" data-accent-color=\"\" href=\"https://docs.sqlalchemy.org/en/14/core/sqlelement.html#sqlalchemy.sql.expression.text\"><code class=\"rt-reset rt-Code rt-variant-soft code-style\" data-accent-color=\"\">sqlalchemy.text</code></a>,\nwhich allows colon-prefix names to be used as placeholders.</p><div class=\"rt-Flex rt-r-fd-column rt-r-ai-start rt-r-gap-3 rx-Stack css-tjvfc7\"><div class=\"rt-Flex rt-r-fd-row rt-r-ai-start rt-r-gap-1 rx-Stack css-99pxke\"><div class=\"rt-Box css-1ha2jce\"><svg class=\"lucide lucide-info css-1yx2zam\" fill=\"none\" height=\"18\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><path d=\"M12 16v-4\"></path><path d=\"M12 8h.01\"></path></svg></div><div class=\"css-1w54oj2\"><p class=\"rt-Text css-56tzch\">Never use string formatting to construct SQL queries, as this may lead to SQL injection vulnerabilities in the app.</p></div></div></div><pre><div class=\"rt-Box relative mb-4\"><div class=\"rt-Box code-block css-1islnds\"><div><pre class=\"shiki one-dark-pro\" style=\"background-color:#282c34;color:#abb2bf\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#C678DD\">import</span><span style=\"color:#ABB2BF\"> sqlalchemy</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#C678DD\">import</span><span style=\"color:#ABB2BF\"> reflex </span><span style=\"color:#C678DD\">as</span><span style=\"color:#ABB2BF\"> rx</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#C678DD\">class</span><span style=\"color:#E5C07B\"> State</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B\">rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#E5C07B\">State</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#61AFEF\">    @rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#61AFEF\">event</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">    def</span><span style=\"color:#61AFEF\"> insert_user_raw</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B;font-style:italic\">self</span><span style=\"color:#ABB2BF\">, </span><span style=\"color:#D19A66;font-style:italic\">username</span><span style=\"color:#ABB2BF\">, </span><span style=\"color:#D19A66;font-style:italic\">email</span><span style=\"color:#ABB2BF\">):</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">        with</span><span style=\"color:#ABB2BF\"> rx.</span><span style=\"color:#61AFEF\">session</span><span style=\"color:#ABB2BF\">() </span><span style=\"color:#C678DD\">as</span><span style=\"color:#ABB2BF\"> session:</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">execute</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                sqlalchemy.</span><span style=\"color:#61AFEF\">text</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#98C379\">                    \"INSERT INTO user (username, email) \"</span></span>\n<span class=\"line\"><span style=\"color:#98C379\">                    \"VALUES (:username, :email)\"</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                ),</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                {</span><span style=\"color:#98C379\">\"username\"</span><span style=\"color:#ABB2BF\">: username, </span><span style=\"color:#98C379\">\"email\"</span><span style=\"color:#ABB2BF\">: email},</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            )</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            session.</span><span style=\"color:#61AFEF\">commit</span><span style=\"color:#ABB2BF\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#61AFEF\">    @rx</span><span style=\"color:#ABB2BF\">.</span><span style=\"color:#61AFEF\">var</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">    def</span><span style=\"color:#61AFEF\"> raw_user_tuples</span><span style=\"color:#ABB2BF\">(</span><span style=\"color:#E5C07B;font-style:italic\">self</span><span style=\"color:#ABB2BF\">) -&gt; list[</span><span style=\"color:#56B6C2\">list</span><span style=\"color:#ABB2BF\">]:</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">        with</span><span style=\"color:#ABB2BF\"> rx.</span><span style=\"color:#61AFEF\">session</span><span style=\"color:#ABB2BF\">() </span><span style=\"color:#C678DD\">as</span><span style=\"color:#ABB2BF\"> session:</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">            return</span><span style=\"color:#ABB2BF\"> [</span></span>\n<span class=\"line\"><span style=\"color:#56B6C2\">                list</span><span style=\"color:#ABB2BF\">(row)</span></span>\n<span class=\"line\"><span style=\"color:#C678DD\">                for</span><span style=\"color:#ABB2BF\"> row </span><span style=\"color:#C678DD\">in</span><span style=\"color:#ABB2BF\"> session.</span><span style=\"color:#61AFEF\">execute</span><span style=\"color:#ABB2BF\">(</span></span>\n<span class=\"line\"><span style=\"color:#98C379\">                    \"SELECT * FROM user\"</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">                ).</span><span style=\"color:#61AFEF\">all</span><span style=\"color:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"color:#ABB2BF\">            ]</span></span>\n<span class=\"line\"></span></code></pre></div><button class=\"css-kobh7h\"><svg class=\"lucide lucide-copy css-cqk0y8\" fill=\"none\" height=\"16\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" viewbox=\"0 0 24 24\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><rect height=\"14\" rx=\"2\" ry=\"2\" width=\"14\" x=\"8\" y=\"8\"></rect><path d=\"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\"></path></svg></button></div></div></pre></article>"
  ]
}